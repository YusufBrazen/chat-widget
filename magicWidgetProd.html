<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width">
    <title>Magic Widget page</title>
    <style>
      iframe#clientPage {
        width: 100%;
        height: 100%;
        position: fixed;
        top: 0;
        left: 0;
      }
      
      #clientPageScreenShot {
        width: 100%;
        height: 100%;
        position: fixed;
        top: 0;
        left: 0;
        
        overflow-y: scroll;
      }
      #clientPageScreenShot img {
        width: 100%;
      }

      fieldset {
        border: solid black 1px;
      }
    </style>

    <script src="https://code.jquery.com/jquery-1.12.4.min.js"
            integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ="
            crossorigin="anonymous"></script>
    
    <script>
      function getQueryParams() {
        var urlParams;
        var match,
            pl     = /\+/g,  // Regex for replacing addition symbol with a space
            search = /([^&=]+)=?([^&]*)/g,
            decode = function (s) { return decodeURIComponent(s.replace(pl, " ")); },
            query  = window.location.search.substring(1);

        urlParams = {};
        while (match = search.exec(query)) {
          urlParams[decode(match[1])] = decode(match[2]);
        }
        return urlParams;
      }
      var queryParams = getQueryParams();
      if (queryParams["siteUrl"] || queryParams["screenShotUrl"]) {
        var scriptTag = document.createElement('script');
        scriptTag.setAttribute("src", "https://app.brazenconnect.com/js/brazen-chat-widget-loader.js");
        scriptTag.setAttribute("id", "brazenChatWidgetScript");
        scriptTag.setAttribute("data-salesforce-id", queryParams["salesforceId"]);
        if (queryParams["mode"] == "job") {
          scriptTag.setAttribute("data-mode", "job");
          scriptTag.setAttribute("data-job-id", queryParams["data-job-id"]);
        }
        else {
          scriptTag.setAttribute("data-mode", "event");
        }
        document.head.appendChild(scriptTag);
        setTimeout(function(){
          $('#form').hide();
        }, 1000);
        
        if (queryParams["siteUrl"]) {
          var clientPage = document.createElement('iframe');
          clientPage.id = 'clientPage';
          clientPage.src = queryParams["siteUrl"];
          clientPage.frameBorder = '0';
          $(document).ready(function() {
            document.body.appendChild(clientPage);
          });

        }
        if (queryParams["screenShotUrl"]) {
          var clientPageScreenShotImg = document.createElement('img');
          clientPageScreenShotImg.src = queryParams["screenShotUrl"];
          var clientPageScreenShotWrapper = document.createElement('div');
          clientPageScreenShotWrapper.id = 'clientPageScreenShot';
          clientPageScreenShotWrapper.appendChild(clientPageScreenShotImg);
          $(document).ready(function() {
            document.body.appendChild(clientPageScreenShotWrapper);
          });
        }
       }
      else {
        var error = document.createElement('h2');
        error.innerText = "Page Cannot Load: need to have 'Site Url' or 'Screenshot Url'";
        $(document).ready(function() {
            document.body.appendChild(clientPageScreenShotWrapper);
          });
      }
    </script>
  </head>
  <body>
    <div id="form">
      <fieldset>
        <legend>See how the Brazen widget looks in any site:</legend>

        <form action="#">
          Site Url: <input type="text" name="siteUrl"/><br/ >
          OR<br/>
          Screenshot Url: <input type="text" name="screenShotUrl"/>
          <hr/ >
          Salesforce ID: <input type="text" name="salesforceId"/><br />
          Type: <input type="radio" name="mode" value="event"/> Event <br />
          Type: <input type="radio" name="mode" value="job"/> Job <br />
          Job ID: <input type="text" name="jobId"/> (required for Type Job)<br />

          <input type="submit"/>
        </form>
      </fieldset>
    </div>
  </body>

</html>
